!function(e){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=e();else if("function"==typeof define&&define.amd)define([],e);else{var f;"undefined"!=typeof window?f=window:"undefined"!=typeof global?f=global:"undefined"!=typeof self&&(f=self),f.dagre=e()}}(function(){return function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a="function"==typeof require&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);var f=new Error("Cannot find module '"+o+"'");throw f.code="MODULE_NOT_FOUND",f}var l=n[o]={exports:{}};t[o][0].call(l.exports,function(e){var n=t[o][1][e];return s(n?n:e)},l,l.exports,e,t,n,r)}return n[o].exports}for(var i="function"==typeof require&&require,o=0;o<r.length;o++)s(r[o]);return s}({1:[function(require,module,exports){module.exports={graphlib:require("./lib/graphlib"),layout:require("./lib/layout"),debug:require("./lib/debug"),util:{time:require("./lib/util").time,notime:require("./lib/util").notime},version:require("./lib/version")}},{"./lib/debug":6,"./lib/graphlib":7,"./lib/layout":9,"./lib/util":29,"./lib/version":30}],2:[function(require,module,exports){"use strict";function run(g){function weightFn(g){return function(e){return g.edge(e).weight}}var fas="greedy"===g.graph().acyclicer?greedyFAS(g,weightFn(g)):dfsFAS(g);_.each(fas,function(e){var label=g.edge(e);g.removeEdge(e),label.forwardName=e.name,label.reversed=!0,g.setEdge(e.w,e.v,label,_.uniqueId("rev"))})}function dfsFAS(g){function dfs(v){_.has(visited,v)||(visited[v]=!0,stack[v]=!0,_.each(g.outEdges(v),function(e){_.has(stack,e.w)?fas.push(e):dfs(e.w)}),delete stack[v])}var fas=[],stack={},visited={};return _.each(g.nodes(),dfs),fas}function undo(g){_.each(g.edges(),function(e){var label=g.edge(e);if(label.reversed){g.removeEdge(e);var forwardName=label.forwardName;delete label.reversed,delete label.forwardName,g.setEdge(e.w,e.v,label,forwardName)}})}var _=require("./lodash"),greedyFAS=require("./greedy-fas");module.exports={run:run,undo:undo}},{"./greedy-fas":8,"./lodash":10}],3:[function(require,module,exports){function addBorderSegments(g){function dfs(v){var children=g.children(v),node=g.node(v);if(children.length&&_.each(children,dfs),_.has(node,"minRank")){node.borderLeft=[],node.borderRight=[];for(var rank=node.minRank,maxRank=node.maxRank+1;maxRank>rank;++rank)addBorderNode(g,"borderLeft","_bl",v,node,rank),addBorderNode(g,"borderRight","_br",v,node,rank)}}_.each(g.children(),dfs)}function addBorderNode(g,prop,prefix,sg,sgNode,rank){var label={width:0,height:0,rank:rank,borderType:prop},prev=sgNode[prop][rank-1],curr=util.addDummyNode(g,"border",label,prefix);sgNode[prop][rank]=curr,g.setParent(curr,sg),prev&&g.setEdge(prev,curr,{weight:1})}var _=require("./lodash"),util=require("./util");module.exports=addBorderSegments},{"./lodash":10,"./util":29}],4:[function(require,module,exports){"use strict";function adjust(g){var rankDir=g.graph().rankdir.toLowerCase();("lr"===rankDir||"rl"===rankDir)&&swapWidthHeight(g)}function undo(g){var rankDir=g.graph().rankdir.toLowerCase();("bt"===rankDir||"rl"===rankDir)&&reverseY(g),("lr"===rankDir||"rl"===rankDir)&&(swapXY(g),swapWidthHeight(g))}function swapWidthHeight(g){_.each(g.nodes(),function(v){swapWidthHeightOne(g.node(v))}),_.each(g.edges(),function(e){swapWidthHeightOne(g.edge(e))})}function swapWidthHeightOne(attrs){var w=attrs.width;attrs.width=attrs.height,attrs.height=w}function reverseY(g){_.each(g.nodes(),function(v){reverseYOne(g.node(v))}),_.each(g.edges(),function(e){var edge=g.edge(e);_.each(edge.points,reverseYOne),_.has(edge,"y")&&reverseYOne(edge)})}function reverseYOne(attrs){attrs.y=-attrs.y}function swapXY(g){_.each(g.nodes(),function(v){swapXYOne(g.node(v))}),_.each(g.edges(),function(e){var edge=g.edge(e);_.each(edge.points,swapXYOne),_.has(edge,"x")&&swapXYOne(edge)})}function swapXYOne(attrs){var x=attrs.x;attrs.x=attrs.y,attrs.y=x}var _=require("./lodash");module.exports={adjust:adjust,undo:undo}},{"./lodash":10}],5:[function(require,module,exports){function List(){var sentinel={};sentinel._next=sentinel._prev=sentinel,this._sentinel=sentinel}function unlink(entry){entry._prev._next=entry._next,entry._next._prev=entry._prev,delete entry._next,delete entry._prev}function filterOutLinks(k,v){return"_next"!==k&&"_prev"!==k?v:void 0}module.exports=List,List.prototype.dequeue=function(){var sentinel=this._sentinel,entry=sentinel._prev;return entry!==sentinel?(unlink(entry),entry):void 0},List.prototype.enqueue=function(entry){var sentinel=this._sentinel;entry._prev&&entry._next&&unlink(entry),entry._next=sentinel._next,sentinel._next._prev=entry,sentinel._next=entry,entry._prev=sentinel},List.prototype.toString=function(){for(var strs=[],sentinel=this._sentinel,curr=sentinel._prev;curr!==sentinel;)strs.push(JSON.stringify(curr,filterOutLinks)),curr=curr._prev;return"["+strs.join(", ")+"]"}},{}],6:[function(require,module,exports){function debugOrdering(g){var layerMatrix=util.buildLayerMatrix(g),h=new Graph({compound:!0,multigraph:!0}).setGraph({});return _.each(g.nodes(),function(v){h.setNode(v,{label:v}),h.setParent(v,"layer"+g.node(v).rank)}),_.each(g.edges(),function(e){h.setEdge(e.v,e.w,{},e.name)}),_.each(layerMatrix,function(layer,i){var layerV="layer"+i;h.setNode(layerV,{rank:"same"}),_.reduce(layer,function(u,v){return h.setEdge(u,v,{style:"invis"}),v})}),h}var _=require("./lodash"),util=require("./util"),Graph=require("./graphlib").Graph;module.exports={debugOrdering:debugOrdering}},{"./graphlib":7,"./lodash":10,"./util":29}],7:[function(require,module,exports){var graphlib;if("function"==typeof require)try{graphlib=require("graphlib")}catch(e){}graphlib||(graphlib=window.graphlib),module.exports=graphlib},{graphlib:void 0}],8:[function(require,module,exports){function greedyFAS(g,weightFn){if(g.nodeCount()<=1)return[];var state=buildState(g,weightFn||DEFAULT_WEIGHT_FN),results=doGreedyFAS(state.graph,state.buckets,state.zeroIdx);return _.flatten(_.map(results,function(e){return g.outEdges(e.v,e.w)}),!0)}function doGreedyFAS(g,buckets,zeroIdx){for(var entry,results=[],sources=buckets[buckets.length-1],sinks=buckets[0];g.nodeCount();){for(;entry=sinks.dequeue();)removeNode(g,buckets,zeroIdx,entry);for(;entry=sources.dequeue();)removeNode(g,buckets,zeroIdx,entry);if(g.nodeCount())for(var i=buckets.length-2;i>0;--i)if(entry=buckets[i].dequeue()){results=results.concat(removeNode(g,buckets,zeroIdx,entry,!0));break}}return results}function removeNode(g,buckets,zeroIdx,entry,collectPredecessors){var results=collectPredecessors?[]:void 0;return _.each(g.inEdges(entry.v),function(edge){var weight=g.edge(edge),uEntry=g.node(edge.v);collectPredecessors&&results.push({v:edge.v,w:edge.w}),uEntry.out-=weight,assignBucket(buckets,zeroIdx,uEntry)}),_.each(g.outEdges(entry.v),function(edge){var weight=g.edge(edge),w=edge.w,wEntry=g.node(w);wEntry["in"]-=weight,assignBucket(buckets,zeroIdx,wEntry)}),g.removeNode(entry.v),results}function buildState(g,weightFn){var fasGraph=new Graph,maxIn=0,maxOut=0;_.each(g.nodes(),function(v){fasGraph.setNode(v,{v:v,"in":0,out:0})}),_.each(g.edges(),function(e){var prevWeight=fasGraph.edge(e.v,e.w)||0,weight=weightFn(e),edgeWeight=prevWeight+weight;fasGraph.setEdge(e.v,e.w,edgeWeight),maxOut=Math.max(maxOut,fasGraph.node(e.v).out+=weight),maxIn=Math.max(maxIn,fasGraph.node(e.w)["in"]+=weight)});var buckets=_.range(maxOut+maxIn+3).map(function(){return new List}),zeroIdx=maxIn+1;return _.each(fasGraph.nodes(),function(v){assignBucket(buckets,zeroIdx,fasGraph.node(v))}),{graph:fasGraph,buckets:buckets,zeroIdx:zeroIdx}}function assignBucket(buckets,zeroIdx,entry){entry.out?entry["in"]?buckets[entry.out-entry["in"]+zeroIdx].enqueue(entry):buckets[buckets.length-1].enqueue(entry):buckets[0].enqueue(entry)}var _=require("./lodash"),Graph=require("./graphlib").Graph,List=require("./data/list");module.exports=greedyFAS;var DEFAULT_WEIGHT_FN=_.constant(1)},{"./data/list":5,"./graphlib":7,"./lodash":10}],9:[function(require,module,exports){"use strict";function layout(g,opts){var time=opts&&opts.debugTiming?util.time:util.notime;time("layout",function(){var layoutGraph=time("  buildLayoutGraph",function(){return buildLayoutGraph(g)});time("  runLayout",function(){runLayout(layoutGraph,time)}),time("  updateInputGraph",function(){updateInputGraph(g,layoutGraph)})})}function runLayout(g,time){time("    makeSpaceForEdgeLabels",function(){makeSpaceForEdgeLabels(g)}),time("    removeSelfEdges",function(){removeSelfEdges(g)}),time("    acyclic",function(){acyclic.run(g)}),time("    nestingGraph.run",function(){nestingGraph.run(g)}),time("    rank",function(){rank(util.asNonCompoundGraph(g))}),time("    injectEdgeLabelProxies",function(){injectEdgeLabelProxies(g)}),time("    removeEmptyRanks",function(){removeEmptyRanks(g)}),time("    nestingGraph.cleanup",function(){nestingGraph.cleanup(g)}),time("    normalizeRanks",function(){normalizeRanks(g)}),time("    assignRankMinMax",function(){assignRankMinMax(g)}),time("    removeEdgeLabelProxies",function(){removeEdgeLabelProxies(g)}),time("    normalize.run",function(){normalize.run(g)}),time("    parentDummyChains",function(){parentDummyChains(g)}),time("    addBorderSegments",function(){addBorderSegments(g)}),time("    order",function(){order(g)}),time("    insertSelfEdges",function(){insertSelfEdges(g)}),time("    adjustCoordinateSystem",function(){coordinateSystem.adjust(g)}),time("    position",function(){position(g)}),time("    positionSelfEdges",function(){positionSelfEdges(g)}),time("    removeBorderNodes",function(){removeBorderNodes(g)}),time("    normalize.undo",function(){normalize.undo(g)}),time("    fixupEdgeLabelCoords",function(){fixupEdgeLabelCoords(g)}),time("    undoCoordinateSystem",function(){coordinateSystem.undo(g)}),time("    translateGraph",function(){translateGraph(g)}),time("    assignNodeIntersects",function(){assignNodeIntersects(g)}),time("    reversePoints",function(){reversePointsForReversedEdges(g)}),time("    acyclic.undo",function(){acyclic.undo(g)})}function updateInputGraph(inputGraph,layoutGraph){_.each(inputGraph.nodes(),function(v){var inputLabel=inputGraph.node(v),layoutLabel=layoutGraph.node(v);inputLabel&&(inputLabel.x=layoutLabel.x,inputLabel.y=layoutLabel.y,layoutGraph.children(v).length&&(inputLabel.width=layoutLabel.width,inputLabel.height=layoutLabel.height))}),_.each(inputGraph.edges(),function(e){var inputLabel=inputGraph.edge(e),layoutLabel=layoutGraph.edge(e);inputLabel.points=layoutLabel.points,_.has(layoutLabel,"x")&&(inputLabel.x=layoutLabel.x,inputLabel.y=layoutLabel.y)}),inputGraph.graph().width=layoutGraph.graph().width,inputGraph.graph().height=layoutGraph.graph().height}function buildLayoutGraph(inputGraph){var g=new Graph({multigraph:!0,compound:!0}),graph=canonicalize(inputGraph.graph());return g.setGraph(_.merge({},graphDefaults,selectNumberAttrs(graph,graphNumAttrs),_.pick(graph,graphAttrs))),_.each(inputGraph.nodes(),function(v){var node=canonicalize(inputGraph.node(v));g.setNode(v,_.defaults(selectNumberAttrs(node,nodeNumAttrs),nodeDefaults)),g.setParent(v,inputGraph.parent(v))}),_.each(inputGraph.edges(),function(e){var edge=canonicalize(inputGraph.edge(e));g.setEdge(e,_.merge({},edgeDefaults,selectNumberAttrs(edge,edgeNumAttrs),_.pick(edge,edgeAttrs)))}),g}function makeSpaceForEdgeLabels(g){var graph=g.graph();graph.ranksep/=2,_.each(g.edges(),function(e){var edge=g.edge(e);edge.minlen*=2,"c"!==edge.labelpos.toLowerCase()&&("TB"===graph.rankdir||"BT"===graph.rankdir?edge.width+=edge.labeloffset:edge.height+=edge.labeloffset)})}function injectEdgeLabelProxies(g){_.each(g.edges(),function(e){var edge=g.edge(e);if(edge.width&&edge.height){var v=g.node(e.v),w=g.node(e.w),label={rank:(w.rank-v.rank)/2+v.rank,e:e};util.addDummyNode(g,"edge-proxy",label,"_ep")}})}function assignRankMinMax(g){var maxRank=0;_.each(g.nodes(),function(v){var node=g.node(v);node.borderTop&&(node.minRank=g.node(node.borderTop).rank,node.maxRank=g.node(node.borderBottom).rank,maxRank=_.max(maxRank,node.maxRank))}),g.graph().maxRank=maxRank}function removeEdgeLabelProxies(g){_.each(g.nodes(),function(v){var node=g.node(v);"edge-proxy"===node.dummy&&(g.edge(node.e).labelRank=node.rank,g.removeNode(v))})}function translateGraph(g){function getExtremes(attrs){var x=attrs.x,y=attrs.y,w=attrs.width,h=attrs.height;minX=Math.min(minX,x-w/2),maxX=Math.max(maxX,x+w/2),minY=Math.min(minY,y-h/2),maxY=Math.max(maxY,y+h/2)}var minX=Number.POSITIVE_INFINITY,maxX=0,minY=Number.POSITIVE_INFINITY,maxY=0,graphLabel=g.graph(),marginX=graphLabel.marginx||0,marginY=graphLabel.marginy||0;_.each(g.nodes(),function(v){getExtremes(g.node(v))}),_.each(g.edges(),function(e){var edge=g.edge(e);_.has(edge,"x")&&getExtremes(edge)}),minX-=marginX,minY-=marginY,_.each(g.nodes(),function(v){var node=g.node(v);node.x-=minX,node.y-=minY}),_.each(g.edges(),function(e){var edge=g.edge(e);_.each(edge.points,function(p){p.x-=minX,p.y-=minY}),_.has(edge,"x")&&(edge.x-=minX),_.has(edge,"y")&&(edge.y-=minY)}),graphLabel.width=maxX-minX+marginX,graphLabel.height=maxY-minY+marginY}function assignNodeIntersects(g){_.each(g.edges(),function(e){var p1,p2,edge=g.edge(e),nodeV=g.node(e.v),nodeW=g.node(e.w);edge.points?(p1=edge.points[0],p2=edge.points[edge.points.length-1]):(edge.points=[],p1=nodeW,p2=nodeV),edge.points.unshift(util.intersectRect(nodeV,p1)),edge.points.push(util.intersectRect(nodeW,p2))})}function fixupEdgeLabelCoords(g){_.each(g.edges(),function(e){var edge=g.edge(e);if(_.has(edge,"x"))switch(("l"===edge.labelpos||"r"===edge.labelpos)&&(edge.width-=edge.labeloffset),edge.labelpos){case"l":edge.x-=edge.width/2+edge.labeloffset;break;case"r":edge.x+=edge.width/2+edge.labeloffset}})}function reversePointsForReversedEdges(g){_.each(g.edges(),function(e){var edge=g.edge(e);edge.reversed&&edge.points.reverse()})}function removeBorderNodes(g){_.each(g.nodes(),function(v){if(g.children(v).length){var node=g.node(v),t=g.node(node.borderTop),b=g.node(node.borderBottom),l=g.node(_.last(node.borderLeft)),r=g.node(_.last(node.borderRight));node.width=Math.abs(r.x-l.x),node.height=Math.abs(b.y-t.y),node.x=l.x+node.width/2,node.y=t.y+node.height/2}}),_.each(g.nodes(),function(v){"border"===g.node(v).dummy&&g.removeNode(v)})}function removeSelfEdges(g){_.each(g.edges(),function(e){if(e.v===e.w){var node=g.node(e.v);node.selfEdges||(node.selfEdges=[]),node.selfEdges.push({e:e,label:g.edge(e)}),g.removeEdge(e)}})}function insertSelfEdges(g){var layers=util.buildLayerMatrix(g);_.each(layers,function(layer){var orderShift=0;_.each(layer,function(v,i){var node=g.node(v);node.order=i+orderShift,_.each(node.selfEdges,function(selfEdge){util.addDummyNode(g,"selfedge",{width:selfEdge.label.width,height:selfEdge.label.height,rank:node.rank,order:i+ ++orderShift,e:selfEdge.e,label:selfEdge.label},"_se")}),delete node.selfEdges})})}function positionSelfEdges(g){_.each(g.nodes(),function(v){var node=g.node(v);if("selfedge"===node.dummy){var selfNode=g.node(node.e.v),x=selfNode.x+selfNode.width/2,y=selfNode.y,dx=node.x-x,dy=selfNode.height/2;g.setEdge(node.e,node.label),g.removeNode(v),node.label.points=[{x:x+2*dx/3,y:y-dy},{x:x+5*dx/6,y:y-dy},{x:x+dx,y:y},{x:x+5*dx/6,y:y+dy},{x:x+2*dx/3,y:y+dy}],node.label.x=node.x,node.label.y=node.y}})}function selectNumberAttrs(obj,attrs){return _.mapValues(_.pick(obj,attrs),Number)}function canonicalize(attrs){var newAttrs={};return _.each(attrs,function(v,k){newAttrs[k.toLowerCase()]=v}),newAttrs}var _=require("./lodash"),acyclic=require("./acyclic"),normalize=require("./normalize"),rank=require("./rank"),normalizeRanks=require("./util").normalizeRanks,parentDummyChains=require("./parent-dummy-chains"),removeEmptyRanks=require("./util").removeEmptyRanks,nestingGraph=require("./nesting-graph"),addBorderSegments=require("./add-border-segments"),coordinateSystem=require("./coordinate-system"),order=require("./order"),position=require("./position"),util=require("./util"),Graph=require("./graphlib").Graph;module.exports=layout;var graphNumAttrs=["nodesep","edgesep","ranksep","marginx","marginy"],graphDefaults={ranksep:50,edgesep:20,nodesep:50,rankdir:"tb"},graphAttrs=["acyclicer","ranker","rankdir","align"],nodeNumAttrs=["width","height"],nodeDefaults={width:0,height:0},edgeNumAttrs=["minlen","weight","width","height","labeloffset"],edgeDefaults={minlen:1,weight:1,width:0,height:0,labeloffset:10,labelpos:"r"},edgeAttrs=["labelpos"]},{"./acyclic":2,"./add-border-segments":3,"./coordinate-system":4,"./graphlib":7,"./lodash":10,"./nesting-graph":11,"./normalize":12,"./order":17,"./parent-dummy-chains":22,"./position":24,"./rank":26,"./util":29}],10:[function(require,module,exports){var lodash;if("function"==typeof require)try{lodash=require("lodash")}catch(e){}lodash||(lodash=window._),module.exports=lodash},{lodash:void 0}],11:[function(require,module,exports){function run(g){var root=util.addDummyNode(g,"root",{},"_root"),depths=treeDepths(g),height=_.max(depths)-1,nodeSep=2*height+1;g.graph().nestingRoot=root,_.each(g.edges(),function(e){g.edge(e).minlen*=nodeSep});var weight=sumWeights(g)+1;_.each(g.children(),function(child){dfs(g,root,nodeSep,weight,height,depths,child)}),g.graph().nodeRankFactor=nodeSep}function dfs(g,root,nodeSep,weight,height,depths,v){var children=g.children(v);if(!children.length)return void(v!==root&&g.setEdge(root,v,{weight:0,minlen:nodeSep}));var top=util.addBorderNode(g,"_bt"),bottom=util.addBorderNode(g,"_bb"),label=g.node(v);g.setParent(top,v),label.borderTop=top,g.setParent(bottom,v),label.borderBottom=bottom,_.each(children,function(child){dfs(g,root,nodeSep,weight,height,depths,child);var childNode=g.node(child),childTop=childNode.borderTop?childNode.borderTop:child,childBottom=childNode.borderBottom?childNode.borderBottom:child,thisWeight=childNode.borderTop?weight:2*weight,minlen=childTop!==childBottom?1:height-depths[v]+1;g.setEdge(top,childTop,{weight:thisWeight,minlen:minlen,nestingEdge:!0}),g.setEdge(childBottom,bottom,{weight:thisWeight,minlen:minlen,nestingEdge:!0})}),g.parent(v)||g.setEdge(root,top,{weight:0,minlen:height+depths[v]})}function treeDepths(g){function dfs(v,depth){var children=g.children(v);children&&children.length&&_.each(children,function(child){dfs(child,depth+1)}),depths[v]=depth}var depths={};return _.each(g.children(),function(v){dfs(v,1)}),depths}function sumWeights(g){return _.reduce(g.edges(),function(acc,e){return acc+g.edge(e).weight},0)}function cleanup(g){var graphLabel=g.graph();g.removeNode(graphLabel.nestingRoot),delete graphLabel.nestingRoot,_.each(g.edges(),function(e){var edge=g.edge(e);edge.nestingEdge&&g.removeEdge(e)})}var _=require("./lodash"),util=require("./util");module.exports={run:run,cleanup:cleanup}},{"./lodash":10,"./util":29}],12:[function(require,module,exports){"use strict";function run(g){g.graph().dummyChains=[],_.each(g.edges(),function(edge){normalizeEdge(g,edge)})}function normalizeEdge(g,e){var v=e.v,vRank=g.node(v).rank,w=e.w,wRank=g.node(w).rank,name=e.name,edgeLabel=g.edge(e),labelRank=edgeLabel.labelRank;if(wRank!==vRank+1){g.removeEdge(e);var dummy,attrs,i;for(i=0,++vRank;wRank>vRank;++i,++vRank)edgeLabel.points=[],attrs={width:0,height:0,edgeLabel:edgeLabel,edgeObj:e,rank:vRank},dummy=util.addDummyNode(g,"edge",attrs,"_d"),vRank===labelRank&&(attrs.width=edgeLabel.width,attrs.height=edgeLabel.height,attrs.dummy="edge-label",attrs.labelpos=edgeLabel.labelpos),g.setEdge(v,dummy,{weight:edgeLabel.weight},name),0===i&&g.graph().dummyChains.push(dummy),v=dummy;g.setEdge(v,w,{weight:edgeLabel.weight},name)}}function undo(g){_.each(g.graph().dummyChains,function(v){var w,node=g.node(v),origLabel=node.edgeLabel;for(g.setEdge(node.edgeObj,origLabel);node.dummy;)w=g.successors(v)[0],g.removeNode(v),origLabel.points.push({x:node.x,y:node.y}),"edge-label"===node.dummy&&(origLabel.x=node.x,origLabel.y=node.y,origLabel.width=node.width,origLabel.height=node.height),v=w,node=g.node(v)})}var _=require("./lodash"),util=require("./util");module.exports={run:run,undo:undo}},{"./lodash":10,"./util":29}],13:[function(require,module,exports){function addSubgraphConstraints(g,cg,vs){var rootPrev,prev={};_.each(vs,function(v){for(var parent,prevChild,child=g.parent(v);child;){if(parent=g.parent(child),parent?(prevChild=prev[parent],prev[parent]=child):(prevChild=rootPrev,rootPrev=child),prevChild&&prevChild!==child)return void cg.setEdge(prevChild,child);child=parent}})}var _=require("../lodash");module.exports=addSubgraphConstraints},{"../lodash":10}],14:[function(require,module,exports){function barycenter(g,movable){return _.map(movable,function(v){var inV=g.inEdges(v);if(inV.length){var result=_.reduce(inV,function(acc,e){var edge=g.edge(e),nodeU=g.node(e.v);return{sum:acc.sum+edge.weight*nodeU.order,weight:acc.weight+edge.weight}},{sum:0,weight:0});return{v:v,barycenter:result.sum/result.weight,weight:result.weight}}return{v:v}})}var _=require("../lodash");module.exports=barycenter},{"../lodash":10}],15:[function(require,module,exports){function buildLayerGraph(g,rank,relationship){var root=createRootNode(g),result=new Graph({compound:!0}).setGraph({root:root}).setDefaultNodeLabel(function(v){return g.node(v)});return _.each(g.nodes(),function(v){var node=g.node(v),parent=g.parent(v);(node.rank===rank||node.minRank<=rank&&rank<=node.maxRank)&&(result.setNode(v),result.setParent(v,parent||root),_.each(g[relationship](v),function(e){var u=e.v===v?e.w:e.v,edge=result.edge(u,v),weight=_.isUndefined(edge)?0:edge.weight;result.setEdge(u,v,{weight:g.edge(e).weight+weight})}),_.has(node,"minRank")&&result.setNode(v,{borderLeft:node.borderLeft[rank],borderRight:node.borderRight[rank]}))}),result}function createRootNode(g){for(var v;g.hasNode(v=_.uniqueId("_root")););return v}var _=require("../lodash"),Graph=require("../graphlib").Graph;module.exports=buildLayerGraph},{"../graphlib":7,"../lodash":10}],16:[function(require,module,exports){"use strict";function crossCount(g,layering){for(var cc=0,i=1;i<layering.length;++i)cc+=twoLayerCrossCount(g,layering[i-1],layering[i]);return cc}function twoLayerCrossCount(g,northLayer,southLayer){for(var southPos=_.zipObject(southLayer,_.map(southLayer,function(v,i){return i})),southEntries=_.flatten(_.map(northLayer,function(v){return _.chain(g.outEdges(v)).map(function(e){return{pos:southPos[e.w],weight:g.edge(e).weight}}).sortBy("pos").value()}),!0),firstIndex=1;firstIndex<southLayer.length;)firstIndex<<=1;var treeSize=2*firstIndex-1;firstIndex-=1;var tree=_.map(new Array(treeSize),function(){return 0}),cc=0;return _.each(southEntries.forEach(function(entry){var index=entry.pos+firstIndex;tree[index]+=entry.weight;for(var weightSum=0;index>0;)index%2&&(weightSum+=tree[index+1]),index=index-1>>1,tree[index]+=entry.weight;cc+=entry.weight*weightSum})),cc}var _=require("../lodash");module.exports=crossCount},{"../lodash":10}],17:[function(require,module,exports){"use strict";function order(g){var maxRank=util.maxRank(g),downLayerGraphs=buildLayerGraphs(g,_.range(1,maxRank+1),"inEdges"),upLayerGraphs=buildLayerGraphs(g,_.range(maxRank-1,-1,-1),"outEdges"),layering=initOrder(g);assignOrder(g,layering);for(var best,bestCC=Number.POSITIVE_INFINITY,i=0,lastBest=0;4>lastBest;++i,++lastBest){sweepLayerGraphs(i%2?downLayerGraphs:upLayerGraphs,i%4>=2),layering=util.buildLayerMatrix(g);var cc=crossCount(g,layering);bestCC>cc&&(lastBest=0,best=_.cloneDeep(layering),bestCC=cc)}assignOrder(g,best)}function buildLayerGraphs(g,ranks,relationship){return _.map(ranks,function(rank){return buildLayerGraph(g,rank,relationship)})}function sweepLayerGraphs(layerGraphs,biasRight){var cg=new Graph;_.each(layerGraphs,function(lg){var root=lg.graph().root,sorted=sortSubgraph(lg,root,cg,biasRight);_.each(sorted.vs,function(v,i){lg.node(v).order=i}),addSubgraphConstraints(lg,cg,sorted.vs)})}function assignOrder(g,layering){_.each(layering,function(layer){_.each(layer,function(v,i){g.node(v).order=i})})}var _=require("../lodash"),initOrder=require("./init-order"),crossCount=require("./cross-count"),sortSubgraph=require("./sort-subgraph"),buildLayerGraph=require("./build-layer-graph"),addSubgraphConstraints=require("./add-subgraph-constraints"),Graph=require("../graphlib").Graph,util=require("../util");module.exports=order},{"../graphlib":7,"../lodash":10,"../util":29,"./add-subgraph-constraints":13,"./build-layer-graph":15,"./cross-count":16,"./init-order":18,"./sort-subgraph":20}],18:[function(require,module,exports){"use strict";function initOrder(g){function dfs(v){if(!_.has(visited,v)){visited[v]=!0;var node=g.node(v);layers[node.rank].push(v),_.each(g.successors(v),dfs)}}var visited={},simpleNodes=_.filter(g.nodes(),function(v){return!g.children(v).length}),maxRank=_.max(_.map(simpleNodes,function(v){return g.node(v).rank})),layers=_.map(_.range(maxRank+1),function(){return[]}),orderedVs=_.sortBy(simpleNodes,function(v){return g.node(v).rank});return _.each(orderedVs,dfs),layers}var _=require("../lodash");module.exports=initOrder},{"../lodash":10}],19:[function(require,module,exports){"use strict";function resolveConflicts(entries,cg){var mappedEntries={};_.each(entries,function(entry,i){var tmp=mappedEntries[entry.v]={indegree:0,"in":[],out:[],vs:[entry.v],i:i};_.isUndefined(entry.barycenter)||(tmp.barycenter=entry.barycenter,tmp.weight=entry.weight)}),_.each(cg.edges(),function(e){var entryV=mappedEntries[e.v],entryW=mappedEntries[e.w];_.isUndefined(entryV)||_.isUndefined(entryW)||(entryW.indegree++,entryV.out.push(mappedEntries[e.w]))});var sourceSet=_.filter(mappedEntries,function(entry){return!entry.indegree});return doResolveConflicts(sourceSet)}function doResolveConflicts(sourceSet){function handleIn(vEntry){return function(uEntry){uEntry.merged||(_.isUndefined(uEntry.barycenter)||_.isUndefined(vEntry.barycenter)||uEntry.barycenter>=vEntry.barycenter)&&mergeEntries(vEntry,uEntry)}}function handleOut(vEntry){return function(wEntry){wEntry["in"].push(vEntry),0===--wEntry.indegree&&sourceSet.push(wEntry)}}for(var entries=[];sourceSet.length;){var entry=sourceSet.pop();entries.push(entry),_.each(entry["in"].reverse(),handleIn(entry)),_.each(entry.out,handleOut(entry))}return _.chain(entries).filter(function(entry){return!entry.merged}).map(function(entry){return _.pick(entry,["vs","i","barycenter","weight"])}).value()}function mergeEntries(target,source){var sum=0,weight=0;target.weight&&(sum+=target.barycenter*target.weight,weight+=target.weight),source.weight&&(sum+=source.barycenter*source.weight,weight+=source.weight),target.vs=source.vs.concat(target.vs),target.barycenter=sum/weight,target.weight=weight,target.i=Math.min(source.i,target.i),source.merged=!0}var _=require("../lodash");module.exports=resolveConflicts},{"../lodash":10}],20:[function(require,module,exports){function sortSubgraph(g,v,cg,biasRight){var movable=g.children(v),node=g.node(v),bl=node?node.borderLeft:void 0,br=node?node.borderRight:void 0,subgraphs={};bl&&(movable=_.filter(movable,function(w){return w!==bl&&w!==br}));var barycenters=barycenter(g,movable);_.each(barycenters,function(entry){if(g.children(entry.v).length){var subgraphResult=sortSubgraph(g,entry.v,cg,biasRight);subgraphs[entry.v]=subgraphResult,_.has(subgraphResult,"barycenter")&&mergeBarycenters(entry,subgraphResult)}});var entries=resolveConflicts(barycenters,cg);expandSubgraphs(entries,subgraphs);var result=sort(entries,biasRight);if(bl&&(result.vs=_.flatten([bl,result.vs,br],!0),g.predecessors(bl).length)){var blPred=g.node(g.predecessors(bl)[0]),brPred=g.node(g.predecessors(br)[0]);_.has(result,"barycenter")||(result.barycenter=0,result.weight=0),result.barycenter=(result.barycenter*result.weight+blPred.order+brPred.order)/(result.weight+2),result.weight+=2}return result}function expandSubgraphs(entries,subgraphs){_.each(entries,function(entry){entry.vs=_.flatten(entry.vs.map(function(v){return subgraphs[v]?subgraphs[v].vs:v}),!0)})}function mergeBarycenters(target,other){_.isUndefined(target.barycenter)?(target.barycenter=other.barycenter,target.weight=other.weight):(target.barycenter=(target.barycenter*target.weight+other.barycenter*other.weight)/(target.weight+other.weight),target.weight+=other.weight)}var _=require("../lodash"),barycenter=require("./barycenter"),resolveConflicts=require("./resolve-conflicts"),sort=require("./sort");module.exports=sortSubgraph},{"../lodash":10,"./barycenter":14,"./resolve-conflicts":19,"./sort":21}],21:[function(require,module,exports){function sort(entries,biasRight){var parts=util.partition(entries,function(entry){return _.has(entry,"barycenter")}),sortable=parts.lhs,unsortable=_.sortBy(parts.rhs,function(entry){return-entry.i}),vs=[],sum=0,weight=0,vsIndex=0;sortable.sort(compareWithBias(!!biasRight)),vsIndex=consumeUnsortable(vs,unsortable,vsIndex),_.each(sortable,function(entry){vsIndex+=entry.vs.length,vs.push(entry.vs),sum+=entry.barycenter*entry.weight,weight+=entry.weight,vsIndex=consumeUnsortable(vs,unsortable,vsIndex)});var result={vs:_.flatten(vs,!0)};return weight&&(result.barycenter=sum/weight,result.weight=weight),result}function consumeUnsortable(vs,unsortable,index){for(var last;unsortable.length&&(last=_.last(unsortable)).i<=index;)unsortable.pop(),vs.push(last.vs),index++;return index}function compareWithBias(bias){return function(entryV,entryW){return entryV.barycenter<entryW.barycenter?-1:entryV.barycenter>entryW.barycenter?1:bias?entryW.i-entryV.i:entryV.i-entryW.i}}var _=require("../lodash"),util=require("../util");module.exports=sort},{"../lodash":10,"../util":29}],22:[function(require,module,exports){function parentDummyChains(g){var postorderNums=postorder(g);_.each(g.graph().dummyChains,function(v){for(var node=g.node(v),edgeObj=node.edgeObj,pathData=findPath(g,postorderNums,edgeObj.v,edgeObj.w),path=pathData.path,lca=pathData.lca,pathIdx=0,pathV=path[pathIdx],ascending=!0;v!==edgeObj.w;){if(node=g.node(v),ascending){for(;(pathV=path[pathIdx])!==lca&&g.node(pathV).maxRank<node.rank;)pathIdx++;pathV===lca&&(ascending=!1)}if(!ascending){for(;pathIdx<path.length-1&&g.node(pathV=path[pathIdx+1]).minRank<=node.rank;)pathIdx++;pathV=path[pathIdx]}g.setParent(v,pathV),v=g.successors(v)[0]}})}function findPath(g,postorderNums,v,w){var parent,lca,vPath=[],wPath=[],low=Math.min(postorderNums[v].low,postorderNums[w].low),lim=Math.max(postorderNums[v].lim,postorderNums[w].lim);parent=v;do parent=g.parent(parent),vPath.push(parent);while(parent&&(postorderNums[parent].low>low||lim>postorderNums[parent].lim));for(lca=parent,parent=w;(parent=g.parent(parent))!==lca;)wPath.push(parent);return{path:vPath.concat(wPath.reverse()),lca:lca}}function postorder(g){function dfs(v){var low=lim;_.each(g.children(v),dfs),result[v]={low:low,lim:lim++}}var result={},lim=0;return _.each(g.children(),dfs),result}var _=require("./lodash");module.exports=parentDummyChains},{"./lodash":10}],23:[function(require,module,exports){"use strict";function findType1Conflicts(g,layering){function visitLayer(prevLayer,layer){var k0=0,scanPos=0,prevLayerLength=prevLayer.length,lastNode=_.last(layer);return _.each(layer,function(v,i){var w=findOtherInnerSegmentNode(g,v),k1=w?g.node(w).order:prevLayerLength;(w||v===lastNode)&&(_.each(layer.slice(scanPos,i+1),function(scanNode){_.each(g.predecessors(scanNode),function(u){var uLabel=g.node(u),uPos=uLabel.order;!(k0>uPos||uPos>k1)||uLabel.dummy&&g.node(scanNode).dummy||addConflict(conflicts,u,scanNode)})}),scanPos=i+1,k0=k1)}),layer}var conflicts={};return _.reduce(layering,visitLayer),conflicts}function findType2Conflicts(g,layering){function scan(south,southPos,southEnd,prevNorthBorder,nextNorthBorder){var v;_.each(_.range(southPos,southEnd),function(i){v=south[i],g.node(v).dummy&&_.each(g.predecessors(v),function(u){var uNode=g.node(u);uNode.dummy&&(uNode.order<prevNorthBorder||uNode.order>nextNorthBorder)&&addConflict(conflicts,u,v)})})}function visitLayer(north,south){var nextNorthPos,prevNorthPos=-1,southPos=0;return _.each(south,function(v,southLookahead){if("border"===g.node(v).dummy){var predecessors=g.predecessors(v);predecessors.length&&(nextNorthPos=g.node(predecessors[0]).order,
scan(south,southPos,southLookahead,prevNorthPos,nextNorthPos),southPos=southLookahead,prevNorthPos=nextNorthPos)}scan(south,southPos,south.length,nextNorthPos,north.length)}),south}var conflicts={};return _.reduce(layering,visitLayer),conflicts}function findOtherInnerSegmentNode(g,v){return g.node(v).dummy?_.find(g.predecessors(v),function(u){return g.node(u).dummy}):void 0}function addConflict(conflicts,v,w){if(v>w){var tmp=v;v=w,w=tmp}var conflictsV=conflicts[v];conflictsV||(conflicts[v]=conflictsV={}),conflictsV[w]=!0}function hasConflict(conflicts,v,w){if(v>w){var tmp=v;v=w,w=tmp}return _.has(conflicts[v],w)}function verticalAlignment(g,layering,conflicts,neighborFn){var root={},align={},pos={};return _.each(layering,function(layer){_.each(layer,function(v,order){root[v]=v,align[v]=v,pos[v]=order})}),_.each(layering,function(layer){var prevIdx=-1;_.each(layer,function(v){var ws=neighborFn(v);if(ws.length){ws=_.sortBy(ws,function(w){return pos[w]});for(var mp=(ws.length-1)/2,i=Math.floor(mp),il=Math.ceil(mp);il>=i;++i){var w=ws[i];align[v]===v&&prevIdx<pos[w]&&!hasConflict(conflicts,v,w)&&(align[w]=v,align[v]=root[v]=root[w],prevIdx=pos[w])}}})}),{root:root,align:align}}function horizontalCompaction(g,layering,root,align,reverseSep){function pass1(v){_.has(visited,v)||(visited[v]=!0,xs[v]=_.reduce(blockG.inEdges(v),function(max,e){return pass1(e.v),Math.max(max,xs[e.v]+blockG.edge(e))},0))}function pass2(v){if(2!==visited[v]){visited[v]++;var node=g.node(v),min=_.reduce(blockG.outEdges(v),function(min,e){return pass2(e.w),Math.min(min,xs[e.w]-blockG.edge(e))},Number.POSITIVE_INFINITY);min!==Number.POSITIVE_INFINITY&&node.borderType!==borderType&&(xs[v]=Math.max(xs[v],min))}}var xs={},blockG=buildBlockGraph(g,layering,root,reverseSep),visited={};_.each(blockG.nodes(),pass1);var borderType=reverseSep?"borderLeft":"borderRight";return _.each(blockG.nodes(),pass2),_.each(align,function(v){xs[v]=xs[root[v]]}),xs}function buildBlockGraph(g,layering,root,reverseSep){var blockGraph=new Graph,graphLabel=g.graph(),sepFn=sep(graphLabel.nodesep,graphLabel.edgesep,reverseSep);return _.each(layering,function(layer){var u;_.each(layer,function(v){var vRoot=root[v];if(blockGraph.setNode(vRoot),u){var uRoot=root[u],prevMax=blockGraph.edge(uRoot,vRoot);blockGraph.setEdge(uRoot,vRoot,Math.max(sepFn(g,v,u),prevMax||0))}u=v})}),blockGraph}function findSmallestWidthAlignment(g,xss){return _.min(xss,function(xs){var min=_.min(xs,function(x,v){return x-width(g,v)/2}),max=_.max(xs,function(x,v){return x+width(g,v)/2});return max-min})}function alignCoordinates(xss,alignTo){var alignToMin=_.min(alignTo),alignToMax=_.max(alignTo);_.each(["u","d"],function(vert){_.each(["l","r"],function(horiz){var delta,alignment=vert+horiz,xs=xss[alignment];xs!==alignTo&&(delta="l"===horiz?alignToMin-_.min(xs):alignToMax-_.max(xs),delta&&(xss[alignment]=_.mapValues(xs,function(x){return x+delta})))})})}function balance(xss,align){return _.mapValues(xss.ul,function(ignore,v){if(align)return xss[align.toLowerCase()][v];var xs=_.sortBy(_.pluck(xss,v));return(xs[1]+xs[2])/2})}function positionX(g){var adjustedLayering,layering=util.buildLayerMatrix(g),conflicts=_.merge(findType1Conflicts(g,layering),findType2Conflicts(g,layering)),xss={};_.each(["u","d"],function(vert){adjustedLayering="u"===vert?layering:_.values(layering).reverse(),_.each(["l","r"],function(horiz){"r"===horiz&&(adjustedLayering=_.map(adjustedLayering,function(inner){return _.values(inner).reverse()}));var neighborFn=_.bind("u"===vert?g.predecessors:g.successors,g),align=verticalAlignment(g,adjustedLayering,conflicts,neighborFn),xs=horizontalCompaction(g,adjustedLayering,align.root,align.align,"r"===horiz);"r"===horiz&&(xs=_.mapValues(xs,function(x){return-x})),xss[vert+horiz]=xs})});var smallestWidth=findSmallestWidthAlignment(g,xss);return alignCoordinates(xss,smallestWidth),balance(xss,g.graph().align)}function sep(nodeSep,edgeSep,reverseSep){return function(g,v,w){var delta,vLabel=g.node(v),wLabel=g.node(w),sum=0;if(sum+=vLabel.width/2,_.has(vLabel,"labelpos"))switch(vLabel.labelpos.toLowerCase()){case"l":delta=-vLabel.width/2;break;case"r":delta=vLabel.width/2}if(delta&&(sum+=reverseSep?delta:-delta),delta=0,sum+=(vLabel.dummy?edgeSep:nodeSep)/2,sum+=(wLabel.dummy?edgeSep:nodeSep)/2,sum+=wLabel.width/2,_.has(wLabel,"labelpos"))switch(wLabel.labelpos.toLowerCase()){case"l":delta=wLabel.width/2;break;case"r":delta=-wLabel.width/2}return delta&&(sum+=reverseSep?delta:-delta),delta=0,sum}}function width(g,v){return g.node(v).width}var _=require("../lodash"),Graph=require("../graphlib").Graph,util=require("../util");module.exports={positionX:positionX,findType1Conflicts:findType1Conflicts,findType2Conflicts:findType2Conflicts,addConflict:addConflict,hasConflict:hasConflict,verticalAlignment:verticalAlignment,horizontalCompaction:horizontalCompaction,alignCoordinates:alignCoordinates,findSmallestWidthAlignment:findSmallestWidthAlignment,balance:balance}},{"../graphlib":7,"../lodash":10,"../util":29}],24:[function(require,module,exports){"use strict";function position(g){g=util.asNonCompoundGraph(g),positionY(g),_.each(positionX(g),function(x,v){g.node(v).x=x})}function positionY(g){var layering=util.buildLayerMatrix(g),rankSep=g.graph().ranksep,prevY=0;_.each(layering,function(layer){var maxHeight=_.max(_.map(layer,function(v){return g.node(v).height}));_.each(layer,function(v){g.node(v).y=prevY+maxHeight/2}),prevY+=maxHeight+rankSep})}var _=require("../lodash"),util=require("../util"),positionX=require("./bk").positionX;module.exports=position},{"../lodash":10,"../util":29,"./bk":23}],25:[function(require,module,exports){"use strict";function feasibleTree(g){var t=new Graph({directed:!1}),start=g.nodes()[0],size=g.nodeCount();t.setNode(start,{});for(var edge,delta;tightTree(t,g)<size;)edge=findMinSlackEdge(t,g),delta=t.hasNode(edge.v)?slack(g,edge):-slack(g,edge),shiftRanks(t,g,delta);return t}function tightTree(t,g){function dfs(v){_.each(g.nodeEdges(v),function(e){var edgeV=e.v,w=v===edgeV?e.w:edgeV;t.hasNode(w)||slack(g,e)||(t.setNode(w,{}),t.setEdge(v,w,{}),dfs(w))})}return _.each(t.nodes(),dfs),t.nodeCount()}function findMinSlackEdge(t,g){return _.min(g.edges(),function(e){return t.hasNode(e.v)!==t.hasNode(e.w)?slack(g,e):void 0})}function shiftRanks(t,g,delta){_.each(t.nodes(),function(v){g.node(v).rank+=delta})}var _=require("../lodash"),Graph=require("../graphlib").Graph,slack=require("./util").slack;module.exports=feasibleTree},{"../graphlib":7,"../lodash":10,"./util":28}],26:[function(require,module,exports){"use strict";function rank(g){switch(g.graph().ranker){case"network-simplex":networkSimplexRanker(g);break;case"tight-tree":tightTreeRanker(g);break;case"longest-path":longestPathRanker(g);break;default:networkSimplexRanker(g)}}function tightTreeRanker(g){longestPath(g),feasibleTree(g)}function networkSimplexRanker(g){networkSimplex(g)}var rankUtil=require("./util"),longestPath=rankUtil.longestPath,feasibleTree=require("./feasible-tree"),networkSimplex=require("./network-simplex");module.exports=rank;var longestPathRanker=longestPath},{"./feasible-tree":25,"./network-simplex":27,"./util":28}],27:[function(require,module,exports){"use strict";function networkSimplex(g){g=simplify(g),initRank(g);var t=feasibleTree(g);initLowLimValues(t),initCutValues(t,g);for(var e,f;e=leaveEdge(t);)f=enterEdge(t,g,e),exchangeEdges(t,g,e,f)}function initCutValues(t,g){var vs=postorder(t,t.nodes());vs=vs.slice(0,vs.length-1),_.each(vs,function(v){assignCutValue(t,g,v)})}function assignCutValue(t,g,child){var childLab=t.node(child),parent=childLab.parent;t.edge(child,parent).cutvalue=calcCutValue(t,g,child)}function calcCutValue(t,g,child){var childLab=t.node(child),parent=childLab.parent,childIsTail=!0,graphEdge=g.edge(child,parent),cutValue=0;return graphEdge||(childIsTail=!1,graphEdge=g.edge(parent,child)),cutValue=graphEdge.weight,_.each(g.nodeEdges(child),function(e){var isOutEdge=e.v===child,other=isOutEdge?e.w:e.v;if(other!==parent){var pointsToHead=isOutEdge===childIsTail,otherWeight=g.edge(e).weight;if(cutValue+=pointsToHead?otherWeight:-otherWeight,isTreeEdge(t,child,other)){var otherCutValue=t.edge(child,other).cutvalue;cutValue+=pointsToHead?-otherCutValue:otherCutValue}}}),cutValue}function initLowLimValues(tree,root){arguments.length<2&&(root=tree.nodes()[0]),dfsAssignLowLim(tree,{},1,root)}function dfsAssignLowLim(tree,visited,nextLim,v,parent){var low=nextLim,label=tree.node(v);return visited[v]=!0,_.each(tree.neighbors(v),function(w){_.has(visited,w)||(nextLim=dfsAssignLowLim(tree,visited,nextLim,w,v))}),label.low=low,label.lim=nextLim++,parent?label.parent=parent:delete label.parent,nextLim}function leaveEdge(tree){return _.find(tree.edges(),function(e){return tree.edge(e).cutvalue<0})}function enterEdge(t,g,edge){var v=edge.v,w=edge.w;g.hasEdge(v,w)||(v=edge.w,w=edge.v);var vLabel=t.node(v),wLabel=t.node(w),tailLabel=vLabel,flip=!1;vLabel.lim>wLabel.lim&&(tailLabel=wLabel,flip=!0);var candidates=_.filter(g.edges(),function(edge){return flip===isDescendant(t,t.node(edge.v),tailLabel)&&flip!==isDescendant(t,t.node(edge.w),tailLabel)});return _.min(candidates,function(edge){return slack(g,edge)})}function exchangeEdges(t,g,e,f){var v=e.v,w=e.w;t.removeEdge(v,w),t.setEdge(f.v,f.w,{}),initLowLimValues(t),initCutValues(t,g),updateRanks(t,g)}function updateRanks(t,g){var root=_.find(t.nodes(),function(v){return!g.node(v).parent}),vs=preorder(t,root);vs=vs.slice(1),_.each(vs,function(v){var parent=t.node(v).parent,edge=g.edge(v,parent),flipped=!1;edge||(edge=g.edge(parent,v),flipped=!0),g.node(v).rank=g.node(parent).rank+(flipped?edge.minlen:-edge.minlen)})}function isTreeEdge(tree,u,v){return tree.hasEdge(u,v)}function isDescendant(tree,vLabel,rootLabel){return rootLabel.low<=vLabel.lim&&vLabel.lim<=rootLabel.lim}var _=require("../lodash"),feasibleTree=require("./feasible-tree"),slack=require("./util").slack,initRank=require("./util").longestPath,preorder=require("../graphlib").alg.preorder,postorder=require("../graphlib").alg.postorder,simplify=require("../util").simplify;module.exports=networkSimplex,networkSimplex.initLowLimValues=initLowLimValues,networkSimplex.initCutValues=initCutValues,networkSimplex.calcCutValue=calcCutValue,networkSimplex.leaveEdge=leaveEdge,networkSimplex.enterEdge=enterEdge,networkSimplex.exchangeEdges=exchangeEdges},{"../graphlib":7,"../lodash":10,"../util":29,"./feasible-tree":25,"./util":28}],28:[function(require,module,exports){"use strict";function longestPath(g){function dfs(v){var label=g.node(v);if(_.has(visited,v))return label.rank;visited[v]=!0;var rank=_.min(_.map(g.outEdges(v),function(e){return dfs(e.w)-g.edge(e).minlen}));return rank===Number.POSITIVE_INFINITY&&(rank=0),label.rank=rank}var visited={};_.each(g.sources(),dfs)}function slack(g,e){return g.node(e.w).rank-g.node(e.v).rank-g.edge(e).minlen}var _=require("../lodash");module.exports={longestPath:longestPath,slack:slack}},{"../lodash":10}],29:[function(require,module,exports){"use strict";function addDummyNode(g,type,attrs,name){var v;do v=_.uniqueId(name);while(g.hasNode(v));return attrs.dummy=type,g.setNode(v,attrs),v}function simplify(g){var simplified=(new Graph).setGraph(g.graph());return _.each(g.nodes(),function(v){simplified.setNode(v,g.node(v))}),_.each(g.edges(),function(e){var simpleLabel=simplified.edge(e.v,e.w)||{weight:0,minlen:1},label=g.edge(e);simplified.setEdge(e.v,e.w,{weight:simpleLabel.weight+label.weight,minlen:Math.max(simpleLabel.minlen,label.minlen)})}),simplified}function asNonCompoundGraph(g){var simplified=new Graph({multigraph:g.isMultigraph()}).setGraph(g.graph());return _.each(g.nodes(),function(v){g.children(v).length||simplified.setNode(v,g.node(v))}),_.each(g.edges(),function(e){simplified.setEdge(e,g.edge(e))}),simplified}function successorWeights(g){var weightMap=_.map(g.nodes(),function(v){var sucs={};return _.each(g.outEdges(v),function(e){sucs[e.w]=(sucs[e.w]||0)+g.edge(e).weight}),sucs});return _.zipObject(g.nodes(),weightMap)}function predecessorWeights(g){var weightMap=_.map(g.nodes(),function(v){var preds={};return _.each(g.inEdges(v),function(e){preds[e.v]=(preds[e.v]||0)+g.edge(e).weight}),preds});return _.zipObject(g.nodes(),weightMap)}function intersectRect(rect,point){var x=rect.x,y=rect.y,dx=point.x-x,dy=point.y-y,w=rect.width/2,h=rect.height/2;if(!dx&&!dy)throw new Error("Not possible to find intersection inside of the rectangle");var sx,sy;return Math.abs(dy)*w>Math.abs(dx)*h?(0>dy&&(h=-h),sx=h*dx/dy,sy=h):(0>dx&&(w=-w),sx=w,sy=w*dy/dx),{x:x+sx,y:y+sy}}function buildLayerMatrix(g){var layering=_.map(_.range(maxRank(g)+1),function(){return[]});return _.each(g.nodes(),function(v){var node=g.node(v),rank=node.rank;_.isUndefined(rank)||(layering[rank][node.order]=v)}),layering}function normalizeRanks(g){var min=_.min(_.map(g.nodes(),function(v){return g.node(v).rank}));_.each(g.nodes(),function(v){var node=g.node(v);_.has(node,"rank")&&(node.rank-=min)})}function removeEmptyRanks(g){var offset=_.min(_.map(g.nodes(),function(v){return g.node(v).rank})),layers=[];_.each(g.nodes(),function(v){var rank=g.node(v).rank-offset;layers[rank]||(layers[rank]=[]),layers[rank].push(v)});var delta=0,nodeRankFactor=g.graph().nodeRankFactor;_.each(layers,function(vs,i){_.isUndefined(vs)&&i%nodeRankFactor!==0?--delta:delta&&_.each(vs,function(v){g.node(v).rank+=delta})})}function addBorderNode(g,prefix,rank,order){var node={width:0,height:0};return arguments.length>=4&&(node.rank=rank,node.order=order),addDummyNode(g,"border",node,prefix)}function maxRank(g){return _.max(_.map(g.nodes(),function(v){var rank=g.node(v).rank;return _.isUndefined(rank)?void 0:rank}))}function partition(collection,fn){var result={lhs:[],rhs:[]};return _.each(collection,function(value){fn(value)?result.lhs.push(value):result.rhs.push(value)}),result}function time(name,fn){var start=_.now();try{return fn()}finally{console.log(name+" time: "+(_.now()-start)+"ms")}}function notime(name,fn){return fn()}var _=require("./lodash"),Graph=require("./graphlib").Graph;module.exports={addDummyNode:addDummyNode,simplify:simplify,asNonCompoundGraph:asNonCompoundGraph,successorWeights:successorWeights,predecessorWeights:predecessorWeights,intersectRect:intersectRect,buildLayerMatrix:buildLayerMatrix,normalizeRanks:normalizeRanks,removeEmptyRanks:removeEmptyRanks,addBorderNode:addBorderNode,maxRank:maxRank,partition:partition,time:time,notime:notime}},{"./graphlib":7,"./lodash":10}],30:[function(require,module,exports){module.exports="0.7.4"},{}]},{},[1])(1)});